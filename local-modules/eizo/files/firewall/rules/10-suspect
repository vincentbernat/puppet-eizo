# -*- sh -*-

# Rules when the suspect LAN is the source. The suspect LAN is for
# stuff that should have access to Internet, but not much else. They
# can however talk to each other.

ip46tables -N LAN-SUSPECT-INPUT
ip46tables -N LAN-SUSPECT-FORWARD
ip46tables -A INPUT -i lan-suspect    -j LAN-SUSPECT-INPUT
ip46tables -A INPUT -i wlan-suspect   -j LAN-SUSPECT-INPUT
ip46tables -A FORWARD -i lan-suspect  -j LAN-SUSPECT-FORWARD
ip46tables -A FORWARD -i wlan-suspect -j LAN-SUSPECT-FORWARD

# Configure IP addresses
main ip addr add $(first $ip[lan-suspect]) dev lan-suspect
main ip addr add $(first $ip[wlan-suspect]) dev wlan-suspect

icmp LAN-SUSPECT-INPUT   10
icmp LAN-SUSPECT-FORWARD 100
dhcp LAN-SUSPECT-INPUT

# Internet access, except port 25
ip46tables -N LAN-SUSPECT-FORWARD-INET
ip46tables -A LAN-SUSPECT-FORWARD -o internet -j LAN-SUSPECT-FORWARD-INET
ip46tables -A LAN-SUSPECT-FORWARD-INET -p tcp --dport smtp -j RETURN
ip46tables -A LAN-SUSPECT-FORWARD-INET -j ACCEPT

reject LAN-SUSPECT-INPUT
reject LAN-SUSPECT-FORWARD
