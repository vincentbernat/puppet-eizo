# -*- sh -*-

# Rules when the guest LAN is the source. The guest LAN is supposed to
# be isolated. No access to internal services and people shouldn't be
# able to talk to each other.

ip46tables -N LAN-GUEST-INPUT
ip46tables -N LAN-GUEST-FORWARD
ip46tables -A INPUT -i lan-guest    -j LAN-GUEST-INPUT
ip46tables -A INPUT -i wlan-guest   -j LAN-GUEST-INPUT
ip46tables -A FORWARD -i lan-guest  -j LAN-GUEST-FORWARD
ip46tables -A FORWARD -i wlan-guest -j LAN-GUEST-FORWARD

# Configure IP addresses
main ip addr replace $(first $ip[lan-guest]) dev lan-guest
main ip addr replace $(first $ip[wlan-guest]) dev wlan-guest

icmp LAN-GUEST-INPUT   10
icmp LAN-GUEST-FORWARD 100
dhcp LAN-GUEST-INPUT

# Internet access, except port 25
ip46tables -N LAN-GUEST-FORWARD-INET
ip46tables -A LAN-GUEST-FORWARD -o internet -j LAN-GUEST-FORWARD-INET
ip46tables -A LAN-GUEST-FORWARD-INET -p tcp --dport smtp -j RETURN
ip46tables -A LAN-GUEST-FORWARD-INET -j ACCEPT

reject LAN-GUEST-INPUT
reject LAN-GUEST-FORWARD
