# Managed by puppet

auto <%= @name %>
<% if @dhcp then -%>
iface <%= @name %> inet dhcp
<% else -%>
iface <%= @name %> inet static
  address <%= @static.split("/")[0] %>
  netmask <%= (IPAddr.new (((1 << @static.split("/")[1].to_i) - 1) << (32 - @static.split("/")[1].to_i)),
                          Socket::AF_INET).to_s %>
<% end -%>
<% if @vlan then -%>
  pre-up    ip link add link <%= @vlan["over"] %> name <%= @name %> type vlan id <%= @vlan["id"] %> egress-qos-map 0:0 6:6 7:7
<% unless @dhcp then -%>
  post-down ip link del <%= @name %>
<% end -%>
<% end -%>
<% @also.each do |name, value| -%>
  <%= name %> <%= value %>
<% end -%>

<% if @dhcp then -%>
iface <%= @name %> inet6 auto
  accept_ra 2
  autoconf 1
  dhcp 1
  request_prefix 1
  post-down pkill -F /run/dhclient6.$IFACE.pid dhclient || true
  post-down ip link del <%= @name %>
<% @interfaces.select { |name, options| options['v6'] }.keys.sort.each do |iface| -%>
  post-down ip -6 addr flush scope global dev <%= iface %> || true
<% end -%>
<% end -%>
