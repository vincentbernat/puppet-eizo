#!/bin/zsh

flexget="<%= @home %>/venv/bin/flexget"
from="<%= @move_from %>"
to="<%= @move_to %>"

# Simple wrappers around flexget that could run in a crontab.

case $1 in
    run)
        (${flexget} --cron execute 3>&1 1>&2 2>&3 | \
             grep -v InsecureRequestWarning) 3>&1 1>&2 2>&3
        :
        ;;
    move)
        cd $from
        for f in **/*.{mkv,srt,avi,mp4}(N); do
            target=$to/${f%%/*}
            [[ ! -d $target ]] || mv $f $target/.
        done
        ;;
esac
