# Configuration file for dnsmasq

# Enable DNS
port=53

# Always require a domain part
domain-needed

# User/group
user=dnsmasq
group=nogroup

# Don't listen to Internet
except-interface=internet
except-interface=internet6

# Default domain
domain=home

# /etc/hosts is not useful
no-hosts

# Don't use ISP resolver. Swisscom doesn't support DNSSEC... Use
# unbound as a recursive dnssec enabled DNS. dnsmasq still stays the
# canonical DNS server since it knows local hosts. unbound will only
# handle resolution to Internet.
no-resolv
server=::1#<%= @unbound_port %>
cache-size=0

<% require 'ipaddr' -%>
# DHCP
dhcp-authoritative
dhcp-leasefile=/var/lib/dnsmasq/dhcp.leases

<% @dhcp.each do |iface, params|
    if params.key? "static" then
     net = params["static"]
     range = (IPAddr.new net).to_range.to_a
-%>
# DHCP for <%= iface  %>
dhcp-range=<%= range[2] %>,<%= range[-2] %>,24h
synth-domain=home,<%= net %>,internal-
host-record=<%= @hostname %>.home,<%= range[1] %>
dhcp-range=::,constructor:<%= iface %>,ra-names
<%  end
   end -%>

# DHCP names
<% @dhcp_hosts.each do |name, mac| -%>
dhcp-host=<%= mac %>,<%= name %>
<% end -%>

# NTP
cname=ntp.home,<%= @hostname %>.home
dhcp-option=option:ntp-server,0.0.0.0
dhcp-option=option6:ntp-server,[fe80::]
