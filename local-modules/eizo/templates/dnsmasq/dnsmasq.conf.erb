# Configuration file for dnsmasq

# Enable DNS
port=53

# Always require a domain part
domain-needed

# DNSSEC
conf-file=/usr/share/dnsmasq-base/trust-anchors.conf
dnssec
# dnssec-check-unsigned

# User/group
user=dnsmasq
group=nogroup

# Don't listen to Internet
except-interface=internet
except-interface=internet6

# Default domain
domain=home

# /etc/hosts is not useful
no-hosts

# Don't use ISP resolver. Swisscom doesn't support DNSSEC...
# resolv-file=/etc/resolv.conf.dhclient
no-resolv
server=2001:4860:4860::8844
server=2001:4860:4860::8888
server=8.8.4.4
server=8.8.8.8

<% require 'ipaddr' -%>
# DHCP
dhcp-leasefile=/var/lib/dnsmasq/dhcp.leases

<% @dhcp.each do |iface, net|
     range = (IPAddr.new net).to_range.to_a
-%>
# DHCP for <%= iface  %>
dhcp-range=<%= range[2] %>,<%= range[-2] %>,24h
synth-domain=home,<%= net %>,internal-
host-record=<%= @hostname %>.home,<%= range[1] %>
dhcp-range=::,constructor:<%= iface %>,ra-names
<% end -%>

# NTP
cname=ntp.home,<%= @hostname %>.home
dhcp-option=option:ntp-server,0.0.0.0
dhcp-option=option6:ntp-server,[fe80::]
